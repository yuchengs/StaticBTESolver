<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>StaticBTESolver: StaticBTESolver</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">StaticBTESolver
   &#160;<span id="projectnumber">0.1</span>
   </div>
   <div id="projectbrief">A open-sourced, gpu accelerated library for the phonon Bolzmann Transport Equation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">StaticBTESolver </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md1"></a>
Dependencies</h1>
<ol type="1">
<li><p class="startli"><code>PETSc</code>: Please consult PETSc documentation <a href="https://www.mcs.anl.gov/petsc/documentation/installation.html">here</a>. Note we recommend you to download and install MPI and/or LAPACK (by providing command line arguments to <code>./configure</code>) even if you have already installed them on your machine. Instructions for your reference: </p><div class="fragment"><div class="line">./configure --with-cc=gcc --with-cxx=g++ --with-fc=gfortran --download-mpich --download-fblaslapack</div>
<div class="line">make all test</div>
</div><!-- fragment --><p class="startli">After installation, take a note on the <code>PETSC_DIR</code> and the <code>PETSC_ARCH</code> variables, you will need them later.</p>
</li>
<li><code>FLTK</code> (optional): gmsh's GUI uses FLTK. So if you want to visualize the mesh generated, you have to install FLTK first. <div class="fragment"><div class="line">curl -O https://www.fltk.org/pub/fltk/1.3.5/fltk-1.3.5-source.tar.gz</div>
<div class="line">tar zxvf fltk-1.3.5-source.tar.gz</div>
<div class="line">cd fltk-1.3.5</div>
<div class="line">./configure</div>
<div class="line">make &amp;&amp; sudo make install</div>
</div><!-- fragment --></li>
<li><code>OpenCASCADE</code> (optional): OpenCASCADE is a free CAD kernel. If gmsh's build-in kernel is enough for you, you may skip this dependency. However, we may support <code>STEP</code> file format in the future, which will probably use <code>OpenCASCADE</code>.</li>
<li><code>gmsh</code> (optional): gmsh is a free mesh generator. To install, consult gmsh documentation <a href="gmsh.info">here</a>. Since we use gmsh api for C++ internally, you will need to compile gmsh as a shared library. <div class="fragment"><div class="line">git clone http://gitlab.onelab.info/gmsh/gmsh.git</div>
<div class="line">cd gmsh</div>
<div class="line">mkdir build</div>
<div class="line">cmake -S. -Bbuild -DENABLE_BUILD_DYNAMIC=1</div>
<div class="line">cd build</div>
<div class="line">make &amp;&amp; sudo make install</div>
</div><!-- fragment --></li>
</ol>
<h1><a class="anchor" id="autotoc_md2"></a>
Installation</h1>
<div class="fragment"><div class="line">git clone --recurse-submodules https://github.com/yuchengs/StaticBTESolver.git</div>
<div class="line">cd StaticBTESolver</div>
</div><!-- fragment --><p>Find the <code>CMakeLists.txt</code> and set <code>PETSC_DIR</code> and <code>PETSC_ARCH</code> to correct ones. Then try to generate building tools with </p><div class="fragment"><div class="line">mkdir build</div>
<div class="line">cmake -S. -Bbuild -DCMAKE_BUILD_TYPE=Release -DPETSC_DIR=... -DPETSC_ARCH=... # for CPU</div>
<div class="line">cmake -S. -Bbuild -DCMAKE_BUILD_TYPE=Release -DUSE_GPU=on # for GPU</div>
</div><!-- fragment --><p>To use GPU version, you should have CUDA support. In case cmake cannot find path to nvcc, provide the path for cmake: </p><div class="fragment"><div class="line">cmake -S. -Bbuild -DCMAKE_BUILD_TYPE=Release -DUSE_GPU=on -DCMAKE_CUDA_COMPILER=path/to/nvcc</div>
</div><!-- fragment --><p>To build: </p><div class="fragment"><div class="line">cd build</div>
<div class="line">make</div>
</div><!-- fragment --><p>For CPU version, you can try ctest in <code>build</code>.</p>
<h1><a class="anchor" id="autotoc_md3"></a>
Running</h1>
<p>After building, you can find a command line utility called <code>BTEcmd</code> under <code>/build/src</code>. This is the entry point to use <code>StaticBTESolver</code> without having to compile and work with APIs.</p>
<p>Several arguments should be provided:</p>
<ul>
<li><code>-g [string]</code> (required): provide a file with either gmsh native file format (with extension <code>.geo</code>) or COMSOL native file format (with extension <code>.mphtxt</code>), or an integer specifying the number of cells if in the setting of 1DG. Note that a <code>.geo</code> file only specifies geometry information while a <code>.mphtxt</code> specifies mesh information. Internally, a <code>.geo</code> file is passed to <code>BTEGeometry</code>, which meshes the geometry and exports to a <code>BTEMesh</code> object. In contrast, a <code>.mphtxt</code> file is passed to the constructor of <code>BTEMesh</code> directly.</li>
<li><code>-m [string]</code> (required): provide a file specifying the bands information in the similar format of <code>Input-dispersion-relation-fp.dat</code>.</li>
<li><code>-b [string]</code> (depends): provide a file specifying the boundary conditions of each boundary. The file format is similar to <code>inputbc2D.dat</code>. If your geometry information is provided with a <code>.geo</code> file, this argument is optional. If absent, you will have to specify boundary conditions interactively. However, if you use a <code>.mphtxt</code> file, this argument is mandatory.</li>
<li><code>-d [integer]</code> (required): provide an integer specifying DM, <b>not</b> DG. (DG is handled automatically) <br  />
</li>
<li><code>-t [integer]</code> (required): CADOM parameter. Number of discrete polar angle.</li>
<li><code>-p [integer]</code> (required): CADOM parameter. Number of discrete azimuthal angle.</li>
<li><code>-T [float]</code> (optional): reference temperature. Default at 300.</li>
<li><code>-I [integer]</code> (optional): maximum number of iteration. Default at 10000.</li>
<li><code>-x [float]</code> (optional): x-axis scale. Default at 0.</li>
<li><code>-y [float]</code> (optional): y-axis scale. Default at 0.</li>
<li><code>-z [float]</code> (optional): z-axis scale. Default at 0.</li>
</ul>
<p>Some sample input files are in the <code>/tests</code> directory. For example, you may try </p><div class="fragment"><div class="line"> {$xslt}</div>
<div class="line">BTEcmd -g path/to/mesh2D.mphtxt \</div>
<div class="line">    -m path/to/Input-dispersion-relation-fp.dat \</div>
<div class="line">    -b path/to/Inputbc2D.dat \</div>
<div class="line">    -d 2 -t 8 -p 8 \</div>
<div class="line">    -x 1e-7 -y 1e-7 -z 1e-7</div>
</div><!-- fragment --><p>If you install the GPU version, use <code>mpirun</code>: </p><div class="fragment"><div class="line"># 2 processes for 2 GPU</div>
<div class="line">mpirun -np 2 ./BTEcmd -g path/to/mesh2D.mphtxt \</div>
<div class="line">                 -m path/to/Input-dispersion-relation-fp.dat \</div>
<div class="line">                 -b path/to/Inputbc2D.dat \</div>
<div class="line">                 -d 2 -t 8 -p 8 \</div>
<div class="line">                 -x 1e-7 -y 1e-7 -z 1e-7</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md4"></a>
Example Usage and Testing</h1>
<ul>
<li><code>2DM1DG</code>: make sure you use files in <code>tests/2DM1DG</code>, ```$xslt ./BTEcmd -x 1e-8 -t 8 -p 1 \ -d 2 -I 1000 \ -g 100 \ -b path/to/tests/2DM1DG/inputbc.dat \ -m path/to/tests/2DM1DG/band.dat <br  />
 ``<code> -</code>3DM1DG<code>: make sure you use files in</code>tests/3DM1DG<code>, </code>``$xslt ./BTEcmd -x 1e-8 -t 8 -p 1 \ -d 3 -I 1000 \ -g 100 \ -b path/to/tests/3DM1DG/inputbc.dat \ -m path/to/tests/3DM1DG/band.dat <br  />
 ``<code> -</code>2DM2DG<code>: make sure you use files in</code>tests/2DM2DG<code>, </code>`` ./BTEcmd -x 1e-4 -y 1e-4 -z 0 -d 2 -t 8 -p 8 -I 1000000 -b path/to/tests/2DM2DG/inputbc.dat -g path/to/tests/2DM2DG/mesh.mphtxt -m path/to/tests/2DM2DG/band.dat ``<code> Note this configuration is slow, maybe try</code>x<code>,</code>y<code>with 1e-8 for faster convergence. -</code>3DM2DG<code>: make sure you use files in</code>tests/3DM2DG<code>, </code>``$xslt ./BTEcmd -x 1e-8 -y 1e-8 -z 0 -t 4 -p 4 \ -d 3 -I 1000 \ -g path/to/tests/3DM2DG/mesh.mphtxt \ -b path/to/tests/3DM2DG/inputbc.dat \ -m path/to/tests/3DM2DG/band.dat ``<code> -</code>3DM3DG<code>: make sure you use files in</code>tests/3DM3DG<code>, </code>``$xslt ./BTEcmd -x 1e-8 -y 1e-8 -z 1e-8 -t 4 -p 4 \ -d 3 -I 1000 \ -g path/to/tests/3DM3DG/mesh.mphtxt \ -b path/to/tests/3DM3DG/inputbc.dat \ -m path/to/tests/3DM3DG/band.dat ```</li>
</ul>
<p>(<b>For Developers</b>): For all those examples, correct results are cached. So for example, you may compare your result from the correct one using the following for <code>3DM3DG</code>: </p><div class="fragment"><div class="line">{$xslt}</div>
<div class="line">   ./BTEcmd -x 1e-8 -y 1e-8 -z 1e-8 -t 4 -p 4 \</div>
<div class="line">       -d 3 -I 1000 \</div>
<div class="line">       -g path/to/tests/3DM3DG/mesh.mphtxt \</div>
<div class="line">       -b path/to/tests/3DM3DG/inputbc.dat \</div>
<div class="line">       -m path/to/tests/3DM3DG/band.dat &gt; outfile</div>
<div class="line">   diff outfile path/to/tests/3DM3DG/3DM3DG.sol</div>
</div><!-- fragment --><p>If there is no output, you are fine. Otherwise your output is incorrect. On macOS, you can do batch checking by calling the shell script <code>test.sh</code> from the source directory. On Linux, results may be different from macOS, so if you do not pass all tests from linux, that does not mean there is any problem. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
